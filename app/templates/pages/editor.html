{% extends "base.html" %}

{% block title %}
    Vision Diagnostic - edit page
{% endblock title %}

{% block extrastyle %}
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-markdown/2.8.0/css/bootstrap-markdown.min.css" rel="stylesheet"/>
{% endblock extrastyle %}

{% block topcontent %}
    <form class="form-horizontal" action="{{ url_for('pages.editor', page_id=page_id or None) }}" method="POST">
        {{ form.hidden_tag() }}
        <fieldset>
            <legend> {{ _('Page Editor') }}</legend>
            <div class="form-group">
                <label class="control-label" for="title">
                    {{ _("Title") }}
                </label>
                <div class="input-group col-md-12">
                    {{form.title(placeholder=_('Title'), id = "title", class = "form-control", required = "" )}}
                </div>
            </div>
            <div class="form-group">
                <label class="control-label" for="slug">
                    {{ _("Slug") }}
                </label>
                <div class="input-group col-md-12">
                    {{form.slug(placeholder=_('Slug'), id = "slug", class = "form-control", required = "" )}}
                </div>
            </div>
            <div class="form-group">
                <div class="input-group col-md-12">
                    {{form.text(placeholder=_('Page text'), required = "", data_provide = "markdown", rows = "16")}}
                    <span class="help-block">
                        {{ _('Learn more about') }} <a href="http://en.wikipedia.org/wiki/Markdown" target="_blank">MarkDown</a>
                    </span>
                </div>
            </div>
            <div class="form-group">
                <div class="input-group col-md-12">
                    {{ form.submit(id="submit", class="btn btn-primary") }}
                </div>
            </div>
        </fieldset>
    </form>
{% endblock %}

{% block js %}
    <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-markdown/2.8.0/js/bootstrap-markdown.min.js">
    </script>
    <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/markdown.js/0.5.0/markdown.min.js">
    </script>
    <script type="text/javascript">
        // Generates a URL-friendly "slug" from a provided string.
        // For example: "This Is Great!!!" transforms into "this-is-great"
        function generateSlug (value) {
          // 1) convert to lowercase
          // 2) remove dashes and pluses
          // 3) replace spaces with dashes
          // 4) remove everything but alphanumeric characters and dashes
          return value.toLowerCase().replace(/-+/g, '').replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');
        };

        $(document).ready()
        {
            $(".form-group #text").markdown({ autofocus:true,savable:false });

            $(".form-horizontal #title").keyup(function(event){
                var value = $(this).val();
                console.log(value);

                $(".form-horizontal #slug").val(generateSlug(value));
            });
        }
    </script>
{% endblock js %}
